{% extends "lfs/base.html" %}
{% load i18n lfs_tags pagination_tags %}
{% load lfs_portlets_tags %}
{% load dh_theme_tags %}

{% block title %}
    {% trans 'Search results' %} - {{ block.super }}
{% endblock %}

{% block section %}search-results{% endblock %}

{% block breadcrumbs %}
    {% breadcrumbs _("Search results") %}
{% endblock %}

{% block left-slot %}
    <div class="portlet">
        
        {% if categories %}
            <div class="portlet-header">
                <h1>Kategorien 
                    {% if categories_reset %}
                        <a href="{% url solr_reset_field %}?q={{ q }}&amp;field=categories">[X]</a>                    
                    {% endif %}
                </h1>
            </div>
            {% for category in categories %}
                <div style="padding: 2px 0">
                    <a href='{% url solr_set_filter %}?q={{ q }}&amp;field=categories&amp;value={{ category.url|urlencode }}'>{{ category.name }} ({{ category.amount }})</a>
                </div>
            {% endfor %}
        {% endif %}
        
        {% if manufacturers %}
            <div class="portlet-header">
                <h1>Hersteller 
                    {% if manufacturer_reset %}
                        <a href="{% url solr_reset_field %}?q={{ q }}&amp;field=manufacturer">[X]</a>
                    {% endif %}                
                </h1>
            </div>        
            {% for manufacturer in manufacturers %}
                <div style="padding: 2px 0">
                    <a href='{% url solr_set_filter %}?q={{ q }}&amp;field=manufacturer&amp;value={{ manufacturer.url|urlencode }}'>{{ manufacturer.name }} ({{ manufacturer.amount }})</a>
                </div>
            {% endfor %}            
        {% endif %}
        <div style="padding-top: 10px; font-weight:bold; text-align:right">
            <a href="{% url solr_reset_filter %}?q={{ q }}">Alle Zur&uuml;cksetzen</a>
        </div>        
    </div>
{% endblock %}

{% block content %}

    <h1 class="first-heading">{% trans 'Search results' %}</h1>

    <label for="search">{% trans 'Search' %}:</label>
    <form action="{% url solr_search %}"
          class="search-results-form">
        <input id="search-input"
               type="text"
               name="q"
               size="50"
               value="{{request.REQUEST.q}}" />
        
        <input type="hidden" name="reset" value="1" />
        <input type="submit"
               value="Suchen">
    </form>

    <form action="{% url solr_set_sorting %}">
               
        <div class="sorting">
            <select name="sorting"
                    onchange="this.form.submit()">
                <option value=""
                    {% ifequal "best" sorting %}selected="selected"{% endifequal %}>{% trans 'Bestes Ergebnis' %}</option>
                <option value="name asc"
                    {% ifequal "name asc" sorting %}selected="selected"{% endifequal %}>{% trans 'Name ascending' %}</option>
                <option value="name desc"
                    {% ifequal "name desc" sorting %}selected="selected"{% endifequal %}>{% trans 'Name descending' %}</option>
                <option value="price asc"
                    {% ifequal "price asc" sorting %}selected="selected"{% endifequal %}>{% trans 'Price ascending' %}</option>
                <option value="price desc"
                    {% ifequal "price desc" sorting %}selected="selected"{% endifequal %}>{% trans 'Price descending' %}</option>
            </select>
            <input type="hidden" name="q" value="{{ q }}" />
        </div>
    
    </form>    
               

    <p class="search-results-description">
        {% trans 'You searched for' %} <span class="search-results-phrase">"{{request.REQUEST.q}}"</span>.
        {% blocktrans count total as counter %}There has been found 1 product.{% plural %}There has been found {{ counter }} products.{% endblocktrans %}
    </p>

    {% if products %}

        <br clear="both">

        {% if display_previous %}
            <a href="{% url solr_search %}?q={{ request.REQUEST.q }}&amp;start={{ previous_start }}">Vorherige Seite</a>
        {% else %}
            <span>Vorherige Seite</span>
        {% endif %}
        
        {% if display_next %}
            <a href="{% url solr_search %}?q={{ request.REQUEST.q }}&amp;start={{ next_start }}">Nächste Seite</a>
        {% else %}
            <span>Nächste Seite</span>
        {% endif %}

        {% for product in products %}

            <div class="product-data1 span-18 last"
                onclick="window.location='{% url lfs.catalog.views.product_view product.slug %}'"
                style="cursor:pointer;"
                onMouseover="this.style.backgroundColor='#eee'";
                onMouseout="this.style.backgroundColor='white'";>

                <div class="product-image1 span-4">

                    <a href="{{product.get_image.url_200x200}}" class="jqzoom" style="" onclick="window.location='{% url lfs.catalog.views.product_view product.slug %}'">
                                                <img src="{{product.get_image.url_200x200}}"
                                title="{{product.get_name}}"
                                alt="{{product.get_name}}"
                                width="120px" height="120px">
                    </a>
                </div>
                <div class="product-description span-10">
                    <h3>{% product_manufacturer %} {{ product.get_name|safe }}</h3>
                    {{ product.get_meta_description|safe }}<br /><br />
                    {% shipping_category_products product %}
                </div>

                <div class="product-footer1" align="right">
                    {% if product.get_for_sale %}
                       <span class="for-sale-standard-price">{{product.get_standard_price|currency}}</span>
                       <span class="for-sale-price1">{{product.get_price|currency}}*</span>
                    {% else %}
                        <span class="standard-price">{{product.get_price|currency}}*</span>
                    {% endif %} <br /><br />
                    <a class="go-on-shopping"
                       onmouseover="this.className='go-on-shopping go-on-shopping-hov'" onmouseout="this.className='go-on-shopping'"
                       href="{% url lfs_product product.slug %}">Zum Produkt
                    </a>
                    <div class="price-disclaimer">
                         *Preis inkl. MwSt. und <br /><a href="/shop/information/versandkosten" target="_blank" onclick="popup('/shop/popup/versandkosten', '700', '700'); return false">Versandkosten</a> deutschlandweit
                    </div>
                </div>
            </div>
            <hr class="product-line" />
        {% endfor %}
    {% endif %}
{% endblock %}